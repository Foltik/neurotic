<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Template</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js" integrity="sha256-UZcJhkL1z2sBS6X+IfDoYsN3G8Cliast0jio7GtJUSc=" crossorigin="anonymous" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.js" integrity="sha256-njhZAUln7gZqA/rnClOIe5f/eE92CJ5GgGSbHSKLsWw=" crossorigin="anonymous" defer></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body></body>
    <script src="lib.js"></script>
    <script defer>
     let sound;

     function preload() {
         preload_hook();
     }

     function setup() {
         setup_hook();

         let canvas = createCanvas(1600, 900);

         sound = stream('https://radio.xyzzy.link/wizard');
         sound.volume = 0.5;
         canvas.mouseClicked(() => sound.paused ? sound.play() : sound.pause());

         bands = fft.getOctaveBands();

         textAlign(CENTER);
         textSize(8);
         noStroke();
     }

     function draw() {
         draw_hook();

         background(0);

         fft.analyze();

         const data = fft.logAverages(bands);
         const len = bands.length;

         range(len).map(i => {
             fill((i * 30) % 100 + 50, 195, ((i * 25) + 50) % 255);

             const h = -height + map(data[i], 0, 255, height, 0);
             rect(((i+1) * width / len) - width/len, height, width/len, h);

             fill(255);
             text(bands[i].lo.toFixed(0), (i + 1) * width / len - width / len / 2, 30);
             text(bands[i].hi.toFixed(0), (i + 1) * width / len - width / len / 2, 45);
         })
     }
    </script>
</html>
