<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Color Multiply Test</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js" integrity="sha256-UZcJhkL1z2sBS6X+IfDoYsN3G8Cliast0jio7GtJUSc=" crossorigin="anonymous" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.js" integrity="sha256-njhZAUln7gZqA/rnClOIe5f/eE92CJ5GgGSbHSKLsWw=" crossorigin="anonymous" defer></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body></body>
    <script src="lib.js"></script>
    <script defer>
     let sound;
     let font;
     let onset;
     let decay;

     function preload() {
         sound = loadSound('candyland.mp3');
         font = loadFont('da_mad_rave_italic.otf');
     }

     function setup() {
         setup_hook();

         let canvas = createCanvas(430, 300);
         canvas.mouseClicked(() => sound.isPlaying() ? sound.pause() : sound.loop());

         const bpm = 128;
         onset = new OnsetDetect(40, 120, 0.025, bpm);
         decay = new Decay(1, 1.05, 1 / (bpm / 60), 50);

         sound.amp(0.2);
     }

     let t = 0;
     function draw() {
         draw_hook();

         blendMode(BLEND);
         background(0);
         textFont(font);

         if (onset.detect()) {
             decay.set(1.05);
         }

         fill(255, 255, 255);
         scale(3 * decay.get());
         range(6).map(i => {
             const factor = 0.5 * sin(t + i * 0.5) + 0.5;
             const [r, g, b] = rgb(0.33, factor, 1);
             fill(r, g, b);
             text('NEUROTIC', 10, i * 14 + 20);
         });

         t += amp.getLevel();
     }
    </script>
</html>
